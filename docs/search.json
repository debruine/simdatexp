[
  {
    "objectID": "confidential.html",
    "href": "confidential.html",
    "title": "Confidential Data",
    "section": "",
    "text": "Using simulation to create reproducible workflows for sensitive data.\nlibrary(faux)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)"
  },
  {
    "objectID": "confidential.html#simple-example-with-faux",
    "href": "confidential.html#simple-example-with-faux",
    "title": "Confidential Data",
    "section": "Simple Example with Faux",
    "text": "Simple Example with Faux\n\niris |&gt;\n  mutate(id = row_number()) |&gt;\n  pivot_longer(Sepal.Length:Petal.Width) |&gt;\n  ggplot(aes(x = name, y = value, color = Species, fill = Species)) +\n  geom_boxplot(alpha = 0.2)\n\n\n\n\n\nsimiris &lt;- sim_df(iris, n = 50, between = \"Species\")\n\n\nsimiris |&gt;\n  mutate(id = row_number()) |&gt;\n  pivot_longer(Sepal.Length:Petal.Width) |&gt;\n  ggplot(aes(x = name, y = value, color = Species, fill = Species)) +\n  geom_boxplot(alpha = 0.2)"
  },
  {
    "objectID": "confidential.html#more-complex-example-wit-synthpop",
    "href": "confidential.html#more-complex-example-wit-synthpop",
    "title": "Confidential Data",
    "section": "More Complex Example wit Synthpop",
    "text": "More Complex Example wit Synthpop\nTo DO"
  },
  {
    "objectID": "testing.html",
    "href": "testing.html",
    "title": "Testing",
    "section": "",
    "text": "library(faux)     # for multilevel data simulation\nlibrary(testthat) # for unit tests\nlibrary(dplyr)    # for data manipulation\nlibrary(ggplot2)  # for plotting\nlibrary(ggridges) # for ridge plots\nlibrary(patchwork) # for combining plots\nlibrary(purrr)    # for iteration\nlibrary(broom)    # for tabular model output\n\nset.seed(8675309) # to make simulation reproducible\ntheme_set(theme_minimal())\nUsing simulation to create unit tests for a code base or statistical method."
  },
  {
    "objectID": "testing.html#simple-example",
    "href": "testing.html#simple-example",
    "title": "Testing",
    "section": "Simple Example",
    "text": "Simple Example\nSimulate data for a between-subjects design.\n\nmessydat &lt;- sim_design(\n  between = list(gender = c(\"male\", \"female\", \"nonbinary\")),\n  n = c(male = 30, female = 50, nonbinary = 5),\n  mu = c(100, 110, 105),\n  sd = 20,\n  dv = \"score\"\n) |&gt;\n  # set 5% of gender and score values to NA\n  messy(prop = 0.05, \"gender\", \"score\")\n\n\n\n\nCheck that the data can be analysed in the desired way.\n\nt.test(score ~ gender, data = messydat)\n\nError in t.test.formula(score ~ gender, data = messydat): grouping factor must have exactly 2 levels\n\n\nWrite unit tests to make sure that the data have the desired properties. Use simulation to check that the tests fail and succeed appropriately.\n\ncleandat &lt;- messydat |&gt;\n  filter(gender %in% c(\"male\", \"female\"),\n         !is.na(score))\n\nCheck that there are no missing scores\nYou can write a test the tells you TRUE or FALSE if the data pass or fail your test:\n\n# Check that there are no missing scores\nall(!is.na(cleandat$score))\n\n[1] TRUE\n\nall(!is.na(messydat$score))\n\n[1] FALSE\n\n\nOr you can use functions from testthat to produce an error if your check fails, but proceed silently if it passes.\n\n# Check that gender is only male or female\nexpect_true( cleandat$gender %in% c(\"female\", \"male\") |&gt; all() )\nexpect_true( messydat$gender %in% c(\"female\", \"male\") |&gt; all() )\n\nError: all(messydat$gender %in% c(\"female\", \"male\")) is not TRUE\n\n`actual`:   FALSE\n`expected`: TRUE"
  },
  {
    "objectID": "testing.html#complex-example",
    "href": "testing.html#complex-example",
    "title": "Testing",
    "section": "Complex Example",
    "text": "Complex Example\nCreate data where you know the ground truth in order to, for example, check the false positive rate of a statistical test.\n\nSimulate Data\nSimulate data with a multilevel structure. Here, face_n faces are rated by rater_n raters for height. Some faces tend to look taller or shorter than they are (this face bias has a normal distribution with a mean of 0 and SD of face_b0_sd) and raters tend to over- or under-estimate (this rater bias has a normal distribution with a mean of 0 and SD of rater_b0_sd). People are pretty bad at estimating height from faces, so there’s a lot of error (represented by sigma). Faces have even or odd birth dates, but there is no actual effect of birthday (bday_effect = 0).\n\n# this function returns a simulated dataset with the specified parameters\nsimdat &lt;- function(face_n = 20,\n                   rater_n = 20,\n                   face_b0_sd = 10,\n                   rater_b0_sd = 10,\n                   sigma = 20,\n                   bday_effect = 0) {\n\n  heights &lt;- rnorm(face_n, 130, 20) |&gt; round()\n\n  data &lt;- add_random(face = face_n) |&gt;\n    mutate(height = heights) |&gt;\n    add_between(\"face\", birthday = c(\"even\", \"odd\")) |&gt;\n    add_contrast(\"birthday\", colnames = \"bday\") |&gt;\n    add_random(rater = rater_n) |&gt;\n    add_ranef(\"rater\", b0_r = rater_b0_sd) |&gt;\n    add_ranef(\"face\", b0_f = face_b0_sd) |&gt;\n    add_ranef(err = sigma) |&gt;\n    mutate(est_height = height + b0_r + b0_f + err + \n             (bday * bday_effect),\n           est_height = round(est_height)) |&gt;\n    select(-b0_r, -b0_f, -err)\n  \n  return(data)\n}\n\n\nsimdat() |&gt; head()\n\n\n\n  \n\n\n\n\nggplot(simdat(), aes(x = est_height, y = face, fill = face)) +\n  geom_density_ridges(alpha = 0.2, scale = 1) +\n  geom_point(aes(x = height, color = face), size = 2, \n             position = position_nudge(y = .2)) +\n  labs(x = \"Estimated height\", y = NULL) +\n  theme(legend.position = \"none\")\n\nPicking joint bandwidth of 10.1\n\n\n\n\n\n\n\nAggregate Data\n\n# this function aggregates data by FACE\naggface &lt;- function(data) {\n  data |&gt;\n    group_by(face, height, birthday) |&gt;\n    summarise(mean_est_height = mean(est_height),\n              sem = sqrt(var(est_height)/length(est_height)),\n              .groups = \"drop\")\n}\n\n\nsimdat() |&gt; aggface() |&gt; head()\n\n\n\n  \n\n\n\n\n# this function aggregates data by RATER\naggrater &lt;- function(data) {\n  data |&gt;\n    group_by(rater, birthday) |&gt;\n    summarise(mean_est_height = mean(est_height),\n              sem = sqrt(var(est_height)/length(est_height)),\n              .groups = \"drop\")\n}\n\n\nsimdat() |&gt; aggrater() |&gt; head()\n\n\n\n  \n\n\n\n\n\nPlot Data\n\nsimdat() |&gt;\n  aggface() |&gt;\n  ggplot(aes(x = height, y = mean_est_height, color = birthday)) +\n  geom_abline(slope = 1, intercept = 0, color = \"grey\") +\n  geom_smooth(aes(group = birthday),\n              method = lm, formula = y ~ x,\n              se = FALSE, linewidth = 0.7) +\n  geom_pointrange(aes(group = face,\n                      ymin = mean_est_height - sem,\n                      ymax = mean_est_height + sem),\n                  size = 0.3, alpha = 0.5) +\n  coord_cartesian(xlim = c(50, 200), ylim = c(50, 200)) +\n  labs(title = \"Aggregated by Face\",\n       x = \"Actual height\",\n       y = \"Estimated Height (mean ± SE)\") +\n  theme(legend.position = c(.1, .8))\n\n\n\n\n\n# this function plots the aggregated data \nplotagg &lt;- function(data, title = \"\") {\n  data |&gt;\n    ggplot(aes(x = birthday, y = mean_est_height, fill = birthday)) +\n    geom_violin(alpha = 0.5) +\n    stat_summary(fun.data = mean_se) +\n    labs(title = title,\n         y = \"Estimated Height (mean ± SE)\") +\n    theme(legend.position = \"none\")\n}\n\n\nplotboth &lt;- function(data) {\n  f &lt;- aggface(data) \n  fplot &lt;- plotagg(f, \"Aggregated by Face\")\n  r &lt;- aggrater(data)\n  rplot &lt;- plotagg(r, \"Aggregated by Rater\")\n  \n  # get plots on the same y-axis range\n  heights &lt;- c(f$mean_est_height, r$mean_est_height)\n  minh &lt;- (min(heights)/10) |&gt; floor()*10\n  maxh &lt;- (max(heights)/10) |&gt; ceiling()*10\n  \n  fplot + rplot & coord_cartesian(ylim = c(minh, maxh))\n}\n\n\nsimdat() |&gt; plotboth()\n\n\n\n\nMore error variability\n\nsimdat(sigma = 50) |&gt; plotboth()\n\n\n\n\nMore raters\n\nsimdat(rater_n = 200) |&gt; plotboth()\n\n\n\n\nMore between-face variability\n\nsimdat(face_b0_sd = 30) |&gt; plotboth()\n\n\n\n\nInduce an effect of birthday, where people born on odd days are 10cm taller than those born on even days.\n\nsimdat(bday_effect = 10) |&gt; plotboth()\n\n\n\n\n\n\nAnalyse Data\nRun a t-test on the data.\n\nttest &lt;- function(data) {\n  t.test(mean_est_height ~ birthday, \n         data = data, \n         paired = TRUE) |&gt;\n    broom::tidy()\n}\n\nSimulate data\n\nd &lt;- simdat()\n\nAggregate by face and test\n\nd |&gt; aggface() |&gt; ttest()\n\n\n\n  \n\n\n\nAggregate by rater and test\n\nd |&gt; aggrater() |&gt; ttest()\n\n\n\n  \n\n\n\n\n\nRepeat\nIf a test has a nominal false positive rate, the power (i.e., the percent of false positives when there is no effect) should be (about) the same as the alpha cutoff. This is because p-values are uniformly distributed when there is no effect.\n\n# run a t.test on values from the same distribution\n# 10000 time and plot the distribution of p-values\np &lt;- replicate(10000, t.test(rnorm(10), rnorm(10))$p.value)\nhist(p)\n\n\n\n\nWe’ll use the psychology default value of 0.05 for alpha here.\n\nalpha &lt;- 0.05\n\nRun your data simulation 100 times, aggregating by face, and calculate the false positive rate, which should be about the same as alpha.\n\nsimresults &lt;- map_df(1:100, ~simdat() |&gt; aggface() |&gt; ttest())\n\nmean(simresults$p.value &lt; alpha)\n\n[1] 0.06\n\n\nRun 100 times aggregating by rater. The false positive rate is very high.\n\nsimresults &lt;- map_df(1:100, ~simdat() |&gt; aggrater() |&gt; ttest())\n\nmean(simresults$p.value &lt; alpha)\n\n[1] 0.73\n\n\nWhat if there are more raters?\n\nsimresults200 &lt;-map_df(1:100, ~simdat(rater_n = 200) |&gt; \n                         aggrater() |&gt; ttest())\n\nmean(simresults200$p.value &lt; alpha)\n\n[1] 0.88"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Simulation Data Examples",
    "section": "",
    "text": "Testing Statistical Methods\nSharing Confidential Data"
  }
]